---
title: Workshop - Paso 2
path: /paso-02
index: 5
---

import Image from '../components/Image'
import { Tabs, TabList, Tab, TabPanels, TabPanel } from '@reach/tabs'

Bueno, ya aprendimos aunque sea lo b√°sico para poder consultar data en GraphQL,
ahora les tengo que dar una mala noticia, todo eso ~~no sirvi√≥ para nada~~ nos
sirve un mont√≥n! ü§£ Nah, la mala noticia es que vamos a tener que usar una
versi√≥n de GraphiQL vieja en la p√°gina de Github que no tiene el Explorer de la
izquierda que tenemos con Gatsby que es SUPER UTIL y ayuda un mont√≥n.

Vamos a [la API GraphQL de Github](https://developer.github.com/v4/explorer/)!

<Image imgName="ghgraphql.png" alt="Github GraphQL API" />

Esto es un poco m√°s complicado pero si hacemos click arriba a la derecha en
**Docs**, vamos a ver un poco de info sobre qu√© estamos consultando. Si borramos
viewer y login (y sus respectivas llaves) podemos ver lo que nos sugiere
GraphiQL si empezamos a tipear. O sino tenemos la
[docu de la API GraphQL de Github](https://developer.github.com/v4/), pero mejor
pensemos juntos y vamos viendo qu√© estamos necesitando.

La data que traigamos con la query que hagamos ac√°, es la data que despu√©s vamos
a tener disponible en nuestro backend (creo que ya lo dije, no? jaja), as√≠ que
veamos, nosotros necesitamos traer nuestros repos, entonces escribamos eso en
nuestra query:

<Image imgName="repos.png" alt="Github GraphQL API query" />

**BUENO ESO DE LOS REPOS ERA MENTIRA**, borren eso y como dije antes, lean la
documentaci√≥n de todo lo que usen. üòÇ

Por practicidad y para no hacerles perder el tiempo, hagamos bien la query.
Nosotros s√≠ necesitamos los repos, pero **de cierto usuario** (_el nuestro_),
as√≠ que borremos "repos" y escribamos "user", lo cual nos va a sugerir un dato
de ese tipo, cliqueemos para seleccionarlo. Ahora posicionemos nuestro puntero
del mouse sobre user un par de segundos y veremos que nos aparece un cartel
explicando el tipo de dato que estamos consultando, hagamos click en el "user"
azul, lo cual nos despliega la documentaci√≥n sobre ese dato.

<Image imgName="queryuser.png" alt="Querying the user in github" />

Ah√≠ a la derecha vemos los argumentos que acepta este dato, que ser√≠a **login:
String!**. Esto nos indica que vamos a tener que indicar un String con clave
**login** y el signo de exclamaci√≥n **!** indica que este valor es _requerido_,
as√≠ que nos deber√≠a quedar algo as√≠:

```javascript
query {
  user (login: "agustinmulet") {
    //Ac√° seguimos
  }
}
```

Obviamente pongan entre comillas **su usuario** üòú sigamos, ya sabemos que vamos
a recibir algo de cierto user, necesitamos ahora s√≠ que sean los repos!
Escribamos "repos" ahora en serio ü§£. Esto nos va a sugerir, entre otras cosas,
_repository_ y _repositories_, si necesitamos lo**s** repositorio**s**, cu√°l les
parece que vamos a necesitar? üòâ

Si hacemos lo mismo que con _user_ antes, podemos ver los argumentos que podemos
usar con lo que nos estamos trayendo. Si eligieron bien, deber√≠amos ver varios
como privacy, orderBy, affiliations, etc. No s√© a ustedes, pero a mi me gust√≥
que est√© primero privacy, ya que nosotros solamente vamos a querer mostrar
nuestros repos p√∫blicos, as√≠ que agreguemos ese filtro, escribamos `(privacy: )`
y les cuento un truquito: aprieten `Ctrl + barra espaciadora` y les va a sugerir
los distintos tipos de repos que acepta `privacy`, esto nos va a simplificar el
laburo üòÑ

Si hicimos todo bien, presionando Ctrl + barra adentro deber√≠amos tener algo
as√≠:

<Image
  imgName="privacy.png"
  alt="Consultando repos Github API"
  style={{ width: '50vw', margin: '0 auto' }}
/>

**KESESO? edges, nodes, whaaattt???** Bueno, ac√° les voy a explicar algo como yo
lo entiendo y como me viene funcionando: cuando queremos traernos una colecci√≥n
de cosas, en este caso de nuestros repositorios, `edges` representa la colecci√≥n
o el **array** y dentro de `edges`, un dato llamado `node` va a representar
**cada objeto** dentro de esa colecci√≥n o array. Se entiende? Quiz√°s cuesta un
poco al principio pero cuanto m√°s usemos GraphQL m√°s se afianzan todos estos
conceptos.

Ahora bien, nosotros necesitamos ese array, as√≠ que vayamos con los `edges` y
dentro consultemos por cada `node`, que representa cada uno de nuestros repos üòé
ya casi estamos, no me odien jaja. Si hacemos Ctrl + barra vemos un
mont√≥¬¥¬¥o√≥√≥√≥√≥n de datos que podemos traer de cada repo, elijan los que les
parezcan m√°s √∫tiles de mostrar! Ahora denle al botoncito de "Play" de arriba
y... **Momento, esto tira error, Agustin ahora s√≠ te odio ü§¨ü§¨üò°** Pero üò¢ lean
mejor el mensaje de error que les dice GraphiQL! Falta proveer un dato `first` o
`last` a los _repositories_, hagamos eso, sumemos al lado de _privacy_ y
pongamos por ejemplo **first: 50** (no s√© ustedes pero yo no tengo m√°s de 15-20
repos en mi cuenta) Demos "Play" de nuevo y veremos nuestros hermosos repos en
cualquier orden ü§£ Podemos ordenarlos con el filtro `orderBy`, pero ya les dejo
a ustedes que ordenen como les guste üòÄ Les dejo c√≥mo hice yo mi query y c√≥mo
deber√≠a quedar el `gatsby-config.js` ac√° abajo üëá

<Tabs>
<TabList>
    <Tab>Soluciones</Tab>
    <Tab>Mi query</Tab>
</TabList>

<TabPanels>

<TabPanel>Para ver la soluci√≥n hac√© click en la pesta√±a üëÜ</TabPanel>

<TabPanel>

```javascript
graphQLQuery: `query {
  user (login:"agustinmulet"){
  repositories(first:50,orderBy:{field:STARGAZERS, direction:DESC},privacy:PUBLIC){
    edges {
      node {
        id
        name
        description
        isPrivate
        url
      	}
    	}
  	}
  }
}`,

```

</TabPanel>
</TabPanels>
</Tabs>

Ahora, como modificamos uno de los archivos de Gatsby, debemos frenar el
servidor local haciendo **Ctrl + C** y volver a levantarlo corriendo **gatsby
develop**. Vayamos a GraphiQL en http://localhost:8000/___graphql y si vemos a
la izquierda, veremos que tenemos algo nuevo para consultar: `allGithubData` y
`githubData`! üòÉ Genial, ahora les dejo armar la query para usar en el frontend,
les dejo como tip que usen `githubData` y no la que ser√≠a **all** ya que esa
ser√≠a por si traemos cosas de varios usuarios, nosotros tenemos uno, as√≠ que nos
alcanza con consultar la data de `githubData` nom√°s. Otra cosa a tener en
cuenta: las queries pueden tener nombre o no, **query Nombre {}**, lo que s√≠,
hay que tener en cuenta que esos nombres **no se pueden repetir** en nuestro
proyecto.

Bueno, con el ejemplo del uso de query + uso de datos en el front en el
componente `layout.js`, les dejo pensar y hacer la query de nuestros repos y
mostrar esa data. Pueden hacer un componente nuevo si quieren, o en una _page_,
lo que m√°s les guste. Les dejo mi componente ac√° üëá y pasamos a la siguiente
parte.

<Tabs>
<TabList>
    <Tab>Soluciones</Tab>
    <Tab>misrepos.js</Tab>
</TabList>

<TabPanels>

<TabPanel>Para ver la soluci√≥n hac√© click en la pesta√±a üëÜ</TabPanel>

<TabPanel>

```jsx
import React from 'react'
import { useStaticQuery, graphql } from 'gatsby'

const MisRepos = () => {
  const repos = useStaticQuery(graphql`
    query MisReposQuery {
      githubData {
        data {
          user {
            repositories {
              edges {
                node {
                  description
                  id
                  isPrivate
                  name
                  url
                }
              }
            }
          }
        }
      }
    }
  `)
  console.log(repos.githubData.data.user.repositories.edges)
  return (
    <table>
      <thead>
        <tr>
          <th>repo.id</th>
          <th>repo.name</th>
          <th>repo.isPrivate</th>
          <th>repo.url</th>
          <th>repo.description</th>
        </tr>
      </thead>
      <tbody>
        {repos.githubData.data.user.repositories.edges.map(({ node }) => (
          <tr key={node.id}>
            <td>{node.id}</td>
            <td>{node.name}</td>
            <td>{node.isPrivate ? 'Privado' : 'P√∫blico'}</td>
            <td>{node.url}</td>
            <td>{node.description}</td>
          </tr>
        ))}
      </tbody>
    </table>
  )
}

export default MisRepos
```

</TabPanel>
</TabPanels>
</Tabs>

## Subiendo nuestro proyecto a Netlify

Gatsby + Netlify = üíùüíû

Bueno, como hablamos de la privacidad, antes de subir nuestro proyecto a
cualquier lado, estar√≠a bueno preservar nuestra key de Github as√≠ no viene
cualquiera y lo usa para cualquier cosa. Usemos entonces variables de entorno üòâ
Empecemos por crear un archivo que se llame `.env.development` (s√≠, empieza con
punto) en la ra√≠z de nuestro proyecto (a la misma altura que los archivos
**gatsby-algo.js**) y luego agregu√©moslo en nuestro archivo `.gitignore` as√≠ nos
aseguramos que no subimos ese archivo a nuestro Github. Adentro de este archivo
**.env.development** vamos a generar una variable de entorno que su nombre
**DEBE EMPEZAR con** `GATSBY_`, por ejemplo:

```javascript
GATSBY_GH_KEY=079b55830a613c38aff7f4608ef2448d83db9758
```

Guardamos y Gatsby como con muchas cosas, ya tiene `dotenv` preconfigurado, as√≠
que para poder acceder a nuestro archivo reci√©n generado y a la variable de
entorno agreguemos en nuestro archivo `gatsby-config.js` lo siguiente:

```javascript
require('dotenv').config({
  path: `.env.${process.env.NODE_ENV}`,
})
```

Y luego en el mismo archivo podemos modificar la configuraci√≥n del token de
nuestro plugin de Github por esto:

```javascript
token: process.env.GATSBY_GH_KEY,
```

Et voil√†! Si bajamos el servidor de desarrollo y lo volvemos a levantar, deber√≠a
seguir funcionando todo normalmente. Ahora nos resta subir nuestro proyecto a
Github con nuestra key guardadita y a salvo, para eso comencemos por entrar a
nuestro usuario de Github, a la parte de repositorios y creemos uno nuevo con el
bot√≥n verde **New** que est√° a la derecha, o
[entrando en este link](https://www.github.com/new). Luego escribimos un nombre
para nuestro repositorio \(por ejemplo "MiPortfolio"\) y no hace falta que
pongamos descripci√≥n ni que lo inicialicemos con un README. Vamos al bot√≥n de
abajo de todo y terminamos de crear nuestro repositorio. Se nos va a crear un
repositorio vac√≠o y el mismo Github que es re copado nos va a decir c√≥mo subir
nuestro proyecto donde dice
`‚Ä¶or push an existing repository from the command line`. Entonces abrimos una
terminal y vamos hasta la carpeta ra√≠z de nuestra app, luego ah√≠ hacemos lo que
nos dice Github:

```bash
git remote add origin https://github.com/agustinmulet/MiPortfolio.git
git push -u origin master
```

Es probable que nos pida nuestro usuario y constrase√±a de Github, en ese caso
ingresamos nuestras credenciales y si todo sali√≥ bien, ya tenemos nuestra app
subida a un repo propio!

Ahora resta hacernos una cuenta en [Netlify](https://www.netlify.com) para subir
nuestro proyecto, para hacerlo hay que entrar con nuestro usuario a Netlify,
hacer click en el bot√≥n verde de arriba a la derecha que dice **New site from
Git** e indicarle cu√°l es el repositorio con nuestra app \(MiPortfolio si le
pusieron el mismo nombre que yo\), aceptamos y continuamos con las
configuraciones que detecta autom√°ticamente Netlify (s√≠, es re copado e
inteligente), esperamos un poco que haga el deploy y ya \(casi\) est√°! Lo que
s√≠, Netlify nos da un nombre raro para nuestro sitio, as√≠ que para cambiar el
nombre al que querramos \(nombredeapp.netlify.com\), tenemos que \(si es que
estamos en el Dashboard principal de Netlify\) hacer click en nuestra app reci√©n
subida con nombre raro, hacer click en el bot√≥n `‚öô Site Settings` y en la parte
de `Site Information` vamos a ver otro bot√≥n `Change site name`, donde podemos
definir el nombre que querramos. Es probable que alg√∫n nombre como MiPortfolio
est√© utilizado, pero podemos inventar algo usando nuestro nombre, o alg√∫n nombre
raro que se les ocurra \(elmejorportfolio, wowsomuchportfolio,
lamejorwebamiguis, loquesea jaja\).

Es probable que nuestro deploy falle, porque nuestra variable de entorno no
existe. Vamos entonces a agregar nuestra variable de entorno en Netlify. Para
esto volvemos a `‚öô Site Settings` de nuestro proyecto y ah√≠ dentro a
`Build & deploy`, `Environment` y creamos una nueva haciendo click en el bot√≥n
`Edit variables`. Nos pide Clave / Valor, por practicidad vamos a poner como
clave el nombre que venimos usando `GATSBY_GH_KEY`y como valor ponemos nuestra
API key **079b55830a613c38aff7f4608ef2448d83db9758** todo as√≠ sin comillas,
solamente el texto.

Guardamos y es posible que tengamos que repetir el tema del deploy, pero es la
forma que conozco de hacerlo funcionar... Para repetir el deploy, vamos al men√∫
`Deploys` y a la derecha vemos un dropdown que dice **Trigger deploy**, hacemos
click ah√≠ y luego en **Deploy site**. Esperamos un rato y deber√≠amos tener todo
subido y funcionando üòé

Ahora resta ponerlo lindo usando css, mostrando todo en cards, im√°genes, lo que
les parezca, eso se los dejo a ustedes!

Y si todav√≠a and√°s con tiempo y ganas, segu√≠ avanzando y hacemos el blog! üòâüòâüòâ
